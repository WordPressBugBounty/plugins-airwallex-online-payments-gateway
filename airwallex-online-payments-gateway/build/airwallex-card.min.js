(()=>{"use strict";"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));jQuery((function(e){const{env:t,locale:a,confirmationUrl:r,isOrderPayPage:n}=awxCommonData,i=n?"#order_review":"form.checkout",{autoCapture:c,errorMessage:l,incompleteMessage:o}=awxEmbeddedCardData,d=function(t){let a=e('input[name="save-card"]:checked').attr("id");return a&&(t+=t?"&":"",t+="token="+a),t};let s,m,u=[],x=null;const w=()=>{m=Airwallex.createElement("card",{autoCapture:c,allowedCardNetworks:["discover","visa","mastercard","maestro","unionpay","amex","jcb","diners"],style:{base:{fontSize:"14px","::placeholder":{color:"rgba(135, 142, 153, 1)"}}}});let e=m.mount("airwallex-card");setInterval((function(){if(document.getElementById("airwallex-card")&&!document.querySelector("#airwallex-card iframe"))try{e=m.mount("airwallex-card")}catch(e){console.warn(e)}}),1e3),window.addEventListener("onError",(e=>{if(!e.detail)return;const{error:t}=e.detail;AirwallexClient.displayCheckoutError(i,String(l).replace("%s",t.message||""))})),s=Airwallex.createElement("cvc",{style:{base:{fontSize:"14px","::placeholder":{color:"rgba(135, 142, 153, 1)"}}},placeholder:awxEmbeddedCardData.CVC}),f()},p=e=>{try{var t=JSON.parse(e);return t&&"object"==typeof t}catch(e){return!1}},y=e=>{if(-1===navigator.userAgent.indexOf("MSIE")&&!document.documentMode)return!0;e.preventDefault()};e("form.checkout").on("checkout_place_order_airwallex_card",(function(){let t=e(this);return t.addClass("processing"),e.ajaxSetup({dataFilter:function(e,t){if("json"!==t)return e;if(p(e))return e;var a=e.match(/{"result.*}/);return null===a||p(a[0])&&(e=a[0]),e}}),_(i),e.ajax({type:"POST",url:awxEmbeddedCardData.getCheckoutAjaxUrl,data:d(t.serialize()),dataType:"json"}).done((function(t){if(y(),e(".checkout-inline-error-message").remove(),"success"!==t.result){let e="Error processing checkout. Please try again.";return t.messages&&"string"==typeof t.messages&&(e=t.messages),void AirwallexClient.displayCheckoutError(i,e)}v(t,m)})).fail((function(t){e(i).unblock(),y(),AirwallexClient.displayCheckoutError(i,t.responseText)})),!1}));const h=async t=>{let a=await e.ajax({type:"GET",url:awxEmbeddedCardData.getCustomerClientSecretAjaxUrl});return await Airwallex.createPaymentConsent({customer_id:a.customer_id,client_secret:a.client_secret,element:m,next_triggered_by:t,currency:awxEmbeddedCardData.currency})};e(document.body).on("click","#place_order",(async function(t){if("airwallex_card"===e('input[name="payment_method"]:checked').val()){if(awxEmbeddedCardData.isAccountPage){t.preventDefault(),_("#payment");let a=e(".awx-alert");a.hide();try{await h("customer")}catch(t){let r=t.message;return"resource_already_exists"===t.code&&(r=awxEmbeddedCardData.resourceAlreadyExistsMessage),e(".awx-alert .body").html(r),a.show(),void e("#payment").unblock()}return e("#add_payment_method").submit(),void e("#payment").unblock()}if(awxCommonData.isOrderPayPage){if(t.preventDefault(),window.location.search.includes("change_payment_method")){t.preventDefault();let a=e(".awx-alert");a.hide(),e("#place_order").prop("disabled",!0);try{let t=await h("merchant");const a=e("#order_review");a.find('input[name="is_change_payment_method"], input[name="awx_customer_id"], input[name="awx_consent_id"]').remove();[{name:"is_change_payment_method",value:"true"},{name:"awx_customer_id",value:t.customer_id},{name:"awx_consent_id",value:t.payment_consent_id}].forEach((t=>{e("<input>",{type:"hidden",name:t.name,value:t.value}).appendTo(a)})),a.trigger("submit")}catch(t){let r=t.message;return e(".awx-alert .body").html(r),a.show(),void e("#place_order").prop("disabled",!1)}return}_(i),e.ajax({type:"POST",data:d(e("#order_review").serialize()),url:awxCommonData.processOrderPayUrl}).done((t=>{"success"===t.result?v(t,m):(e("#order_review").unblock(),AirwallexClient.displayCheckoutError(i,String(l).replace("%s",t.error||"")))})).fail((t=>{e("#order_review").unblock(),AirwallexClient.displayCheckoutError(i,String(l).replace("%s",t.message||""))}))}}}));const _=t=>{setTimeout((function(){e(t).block({message:null,overlayCSS:{background:"#fff",opacity:.6}})}),50)},v=async(t,a)=>{if(!t||t.error)return AirwallexClient.displayCheckoutError(i,String(l).replace("%s","")),void e(i).unblock();if(t.redirect)-1===t.redirect.indexOf("https://")||-1===t.redirect.indexOf("http://")?window.location=t.redirect:window.location=decodeURI(t.redirect);else{try{if(t.createConsent)await Airwallex.createPaymentConsent({intent_id:t.paymentIntent,customer_id:t.customerId,client_secret:t.clientSecret,currency:t.currency,element:a,next_triggered_by:"merchant",billing:AirwallexClient.getBillingInformation()});else if(t.consentId){if(!("none"===e("#"+t.tokenId+"-cvc").css("display")||x&&x.complete))throw new Error("Security Code is incomplete.");await Airwallex.confirmPaymentIntent({element:s,intent_id:t.paymentIntent,client_secret:t.clientSecret,payment_consent_id:t.consentId,payment_method:{billing:AirwallexClient.getBillingInformation()},payment_method_options:{card:{auto_capture:c}}})}else e("#airwallex-save").prop("checked")?await Airwallex.createPaymentConsent({intent_id:t.paymentIntent,customer_id:t.customerId,client_secret:t.clientSecret,currency:t.currency,element:a,next_triggered_by:"customer",billing:AirwallexClient.getBillingInformation()}):await Airwallex.confirmPaymentIntent({element:a,intent_id:t.paymentIntent,client_secret:t.clientSecret,payment_method:{card:{name:AirwallexClient.getCardHolderName()},billing:AirwallexClient.getBillingInformation()}})}catch(t){if("invalid_status_for_operation"!==t.code)return AirwallexClient.displayCheckoutError(i,String(l).replace("%s",t.message||"")),void e(i).unblock()}location.href=function(e,t,a){const r=new URL(e),n=new URLSearchParams(r.search);n.set("order_id",t),n.set("intent_id",a);const i=document.getElementById("airwallex-save");return i&&i.checked&&n.set("is_airwallex_save_checked","true"),r.search=n.toString(),r.toString()}(r,t.orderId,t.paymentIntent)}};awxCommonData&&((e,t,a)=>{const r=setInterval((()=>{window.Airwallex&&(clearInterval(r),Airwallex.init({env:e,locale:t,origin:window.location.origin}),a())}),1e3)})(t,a,w);const g=function(){e(".airwallex-container .new-card, .save-card input").removeAttr("checked"),e(".airwallex-container .save-card input").removeAttr("checked"),e(".airwallex-container .new-card-title, #airwallex-card, .line.save, .cvc-title, .cvc-container").hide(),e(".airwallex-container .save-card label").css("font-weight",400)};e(document).on("click",".save-card",(function(t){g(),e(this).find("input").prop("checked",!0),e("#airwallex-new-card").removeAttr("checked"),e(".cvc-title, .cvc-container").hide(),e(".airwallex-container label").css("font-weight",400),e(this).find("label").css("font-weight",700);let a=e('input[name="save-card"]:checked').attr("id"),r=e(".save-card-"+a+" .cvc-title, .save-card-"+a+" .cvc-container");u?.[a]?.is_skip_cvc?r.hide():(r.show(),s.mount(a+"-cvc",{autoCapture:c}),x=null,s.on("change",(e=>{x=e.detail})))})),e(document).on("click",".new-card",(function(t){g(),e(".new-card-title, #airwallex-card, .line.save").show(),e(this).find("label").css("font-weight",700)}));let f=async()=>{if(!e("#payment_method_airwallex_card").is(":checked"))return;if(!e(".airwallex-container .save-cards").length)return;if(!u||!Object.keys(u).length){_("#payment");let t=await e.ajax({type:"GET",url:awxEmbeddedCardData.getTokensAjaxUrl});e("#payment").unblock(),u=t.tokens}if(e(".payment_method_airwallex_card .wc-awx-checkbox-spinner").hide(),!u||!Object.keys(u).length)return e(".airwallex-container").show(),void e(".airwallex-container .new-card").hide();let t="";for(let e of Object.values(u)){let a=e.type.toLowerCase().replace(/\s+/g,"");"americanexpress"===a&&(a="amex"),"dinersclub"===a&&(a="diners"),t+=`       \n                <div class="save-card save-card-${e.id}">\n                    <div class="save-card-information line">\n                        <input type="radio" name="save-card" id="${e.id}"> \n                        <label for="${e.id}">\n                            <span>${e.formatted_type} •••• ${e.last4} (expires ${e.expiry_month}/${e.expiry_year.slice(-2)})</span> \n                            <img src="${awxEmbeddedCardData.cardLogos["card_"+a]}" class="airwallex-card-icon" alt="Credit Card">\n                        </label> \n                    </div>\n                    <div class="cvc-title" style="display: none;">Security code</div>   \n                    <div id="${e.id}-cvc" class="cvc-container" style="display: none;"></div>    \n                </div>\n            `}e(".airwallex-container").show(),e(".airwallex-container .save-cards").html(t),e(".airwallex-container .new-card").show(),e(".save-card").first().trigger("click")};e(document).on("change","#payment_method_airwallex_card",f),e(document).on("updated_checkout",f)}))})();