(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.jQuery;var a=e.n(t);const n=e=>awxExpressCheckoutSettings.ajaxUrl.toString().replace("%%endpoint%%","airwallex_"+e),s=e=>{var t,s,o,i;const r={security:awxExpressCheckoutSettings.nonce.shipping,country:null!==(t=e.countryCode)&&void 0!==t?t:"",state:null!==(s=e.administrativeArea)&&void 0!==s?s:"",postcode:null!==(o=e.postalCode)&&void 0!==o?o:"",city:null!==(i=e.locality)&&void 0!==i?i:""};return a().ajax({type:"POST",data:r,url:n("get_shipping_options")}).done((function(e){return e})).fail((function(e){return{success:!1,message:e}}))},o=(e,t)=>{for(let a in t)t[a]=e;const s={security:awxExpressCheckoutSettings.nonce.updateShipping,shippingMethods:t};return a().ajax({type:"POST",data:s,url:n("update_shipping_method")}).done((function(e){return e})).fail((function(e){return{success:!1,message:e}}))},i=()=>{let e=a()(".single_add_to_cart_button").val();a()(".single_variation_wrap").length&&(e=a()(".single_variation_wrap").find('input[name="product_id"]').val());let t={security:awxExpressCheckoutSettings.nonce.estimateCart,product_id:e,qty:a()(".quantity .qty").val(),attributes:a()(".variations_form").length?p().data:[]},s=a()("form.cart").serializeArray();return a().each(s,(function(e,a){if(/^addon-/.test(a.name))if(/\[\]$/.test(a.name)){let e=a.name.substring(0,a.name.length-2);t[e]?t[e].push(a.value):t[e]=[a.value]}else t[a.name]=a.value})),a().ajax({type:"POST",data:t,url:n("get_estimated_cart_details")}).done((function(e){return e})).fail((function(e){return{success:!1,message:e}}))},r=()=>{let e=a()(".single_add_to_cart_button").val();a()(".single_variation_wrap").length&&(e=a()(".single_variation_wrap").find('input[name="product_id"]').val());let t={security:awxExpressCheckoutSettings.nonce.addToCart,product_id:e,qty:a()(".quantity .qty").val(),attributes:a()(".variations_form").length?p().data:[]},s=a()("form.cart").serializeArray();return a().each(s,(function(e,a){if(/^addon-/.test(a.name))if(/\[\]$/.test(a.name)){let e=a.name.substring(0,a.name.length-2);t[e]?t[e].push(a.value):t[e]=[a.value]}else t[a.name]=a.value})),a().ajax({type:"POST",data:t,url:n("add_to_cart")}).done((function(e){return e})).fail((function(e){return{success:!1,message:e}}))},c=()=>{const e={security:awxExpressCheckoutSettings.nonce.payment};return a().ajax({type:"POST",data:e,url:n("get_cart_details")}).done((function(e){return e})).fail((function(e){return{success:!1,message:e}}))},l=(e,t)=>{const s="googlepay"===t?u(e):d(e);return a().ajax({type:"POST",data:s,url:n("create_order")}).done((function(e){return e})).fail((function(e){return e}))},p=()=>{let e=a()(".variations_form").find(".variations select"),t={},n=0,s=0;return e.each((function(){let e=a()(this).data("attribute_name")||a()(this).attr("name"),o=a()(this).val()||"";o.length>0&&s++,n++,t[e]=o})),{count:n,chosenCount:s,data:t}},u=e=>{const t=e.paymentMethodData.info.billingAddress,a=e.shippingAddress,n={billing_first_name:t?t.name.split(" ").slice(0,1).join(" "):"",billing_last_name:t?t.name.split(" ").slice(1).join(" "):"",billing_company:"",billing_email:e.email?e.email:"",billing_phone:t?t.phoneNumber:"",billing_country:t?t.countryCode:"",billing_address_1:t?t.address1:"",billing_address_2:t?t.address2.concat(" ",t.address3).trim():"",billing_city:t?t.locality:"",billing_state:t?t.administrativeArea:"",billing_postcode:t?t.postalCode:""},s={shipping_first_name:a?a.name.split(" ").slice(0,1).join(" "):"",shipping_last_name:a?a.name.split(" ").slice(1).join(" "):"",shipping_company:a&&a.organization?a.organization:"",shipping_country:a?a.countryCode:"",shipping_address_1:a?a.address1:"",shipping_address_2:a?a.address2.concat(" ",a.address3).trim():"",shipping_city:a?a.locality:"",shipping_state:a?a.administrativeArea:"",shipping_postcode:a?a.postalCode:"",shipping_method:[e.shippingOptionData?e.shippingOptionData.id:null]};return Object.assign({_wpnonce:awxExpressCheckoutSettings.nonce.checkout,order_comments:"",payment_method:"airwallex_express_checkout",ship_to_different_address:1,terms:1,payment_method_type:"googlepay"},n,s)},d=e=>{let t=e.billingContact;const a=e.shippingContact,n={billing_first_name:t?t.givenName:"",billing_last_name:t?t.familyName:"",billing_company:"",billing_email:t&&t.emailAddress?t.emailAddress:a?a.emailAddress:"",billing_phone:t&&t.phoneNumber?t.phoneNumber:a?a.phoneNumber:"",billing_country:t?t.countryCode:"",billing_address_1:t&&t.addressLines&&t.addressLines.length>0?t.addressLines.shift():"",billing_address_2:t&&t.addressLines?t.addressLines.join(" "):"",billing_city:t?t.locality?t.locality:t.administrativeArea:"",billing_state:t?t.administrativeArea:"",billing_postcode:t?t.postalCode:""},s={shipping_first_name:a?a.givenName:"",shipping_last_name:a?a.familyName:"",shipping_company:"",shipping_country:a?a.countryCode:"",shipping_address_1:a&&a.addressLines&&a.addressLines.length>0?a.addressLines.shift():"",shipping_address_2:a&&a.addressLines?a.addressLines.join(" "):"",shipping_city:a?a.locality?a.locality:a.administrativeArea:"",shipping_state:a?a.administrativeArea:"",shipping_postcode:a?a.postalCode:"",shipping_method:e.shippingMethods?e.shippingMethods:[null]};return Object.assign({_wpnonce:awxExpressCheckoutSettings.nonce.checkout,order_comments:"",payment_method:"airwallex_express_checkout",ship_to_different_address:1,terms:1,payment_method_type:"applepay"},n,s)},g=function(){jQuery.unblockUI()},h=["email","name","phone","postalAddress"],m=e=>e?["email","name","phone","postalAddress"]:["email","phone"],y=e=>e.map((e=>({label:e.label,amount:e.price})));jQuery((function(e){e.ajax({url:awxCommonData.getExpressCheckoutData.url+"&security="+awxCommonData.getExpressCheckoutData.nonce,method:"GET",dataType:"json",async:!1,success:function(e){window.awxExpressCheckoutSettings=e.data,window.awxExpressCheckoutSettings.checkout=awxCommonData.getExpressCheckoutData.checkout},error:function(e,t,a){console.error(t,a)}});const t=awxCommonData.getExpressCheckoutData.hasSubscriptionProduct?"recurring":"oneoff";let p,u,d=[],_=[],w={},f=!1;const x=function(){f?setTimeout((function(){f=!1}),1e3):(f=!0,b.init())},b={init:async function(){if(!("awxExpressCheckoutSettings"in window)||0===Object.keys(awxExpressCheckoutSettings).length)return;if(w=awxCommonData.getExpressCheckoutData.isProductPage?await i():await c(),!w?.orderInfo?.total?.amount)return;const{button:e,checkout:a}=awxExpressCheckoutSettings;awxExpressCheckoutSettings.applePayEnabled&&t in a.allowedCardNetworks.applepay&&a.allowedCardNetworks.applepay[t].length>0&&(u&&u.destroy(),b.initApplePayButton()),awxExpressCheckoutSettings.googlePayEnabled&&t in a.allowedCardNetworks.googlepay&&a.allowedCardNetworks.googlepay[t].length>0&&(p&&p.destroy(),b.initGooglePayButton())},initGooglePayButton:async function(){const t=await b.getGooglePayRequestOptions();p=Airwallex.createElement("googlePayButton",t);p.mount("awx-ec-google-pay-btn");p.on("ready",(t=>{e("#awx-express-checkout-wrapper").show(),e(".awx-google-pay-btn").show(),e("#awx-express-checkout-button-separator").show(),e(".awx-express-checkout-error").html("").hide()})),p.on("click",(t=>{e(".awx-express-checkout-error").html("").hide()})),p.on("shippingAddressChange",(async e=>{const{callbackTrigger:t,shippingAddress:a}=e.detail.intermediatePaymentData;"INITIALIZE"==t&&awxCommonData.getExpressCheckoutData.isProductPage&&await r();let n={};const o=await s(a);var i;o&&o.success?(d={shippingMethods:o.shipping.shippingMethods,shippingOptions:(i=o.shipping.shippingOptions,i.map((e=>({id:e.id,label:e.label,description:e.description}))))},n.shippingOptionParameters={defaultSelectedOptionId:d.shippingMethods[0],shippingOptions:d.shippingOptions},n=Object.assign(n,b.getGoogleTransactionInfo(o.cart))):(d=[],n.error={reason:"SHIPPING_ADDRESS_UNSERVICEABLE",message:o.message,intent:"SHIPPING_ADDRESS"}),p.update(n)})),p.on("shippingMethodChange",(async e=>{const{shippingOptionData:t}=e.detail.intermediatePaymentData;let a={};const n=await o(t.id,d.shippingMethods);n&&n.success?a=b.getGoogleTransactionInfo(n.cart):a.error={reason:"SHIPPING_OPTION_INVALID",message:n.message,intent:"SHIPPING_OPTION"},p.update(a)})),p.on("authorized",(async e=>{awxCommonData.getExpressCheckoutData.isProductPage&&await r();const t=await l(e.detail.paymentData,"googlepay");t.redirect_url?location.href=t.redirect_url:b.processPayment(p,t)})),p.on("error",(e=>{console.error("There was an error",e)}))},getGooglePayRequestOptions:async function(){const e=awxCommonData.getExpressCheckoutData.isProductPage?await i():await c(),{button:a,checkout:n,merchantInfo:s,transactionId:o}=awxExpressCheckoutSettings;if(!e.success)return console.warn(response.message),[];let r={mode:t,buttonColor:a.theme,buttonType:a.buttonType,emailRequired:!0,billingAddressRequired:!(n.isVirtualPurchase&&n.isSkipBillingForVirtual),billingAddressParameters:{format:"FULL",phoneNumberRequired:n.requiresPhone},merchantInfo:{merchantName:s.businessName},autoCapture:n.autoCapture},l=["PAYMENT_AUTHORIZATION"];e.requiresShipping&&(l.push("SHIPPING_ADDRESS","SHIPPING_OPTION"),r.shippingAddressRequired=!0,r.shippingOptionRequired=!0,r.shippingAddressParameters={phoneNumberRequired:n.requiresPhone}),r.callbackIntents=l;const p=b.getGoogleTransactionInfo(e);return r=Object.assign(r,p),r},getGoogleTransactionInfo:function(e){const{checkout:t,transactionId:a}=awxExpressCheckoutSettings;return{amount:{value:e.orderInfo.total.amount||0,currency:e.currencyCode||t.currencyCode},transactionId:a,totalPriceLabel:t.totalPriceLabel,countryCode:e.countryCode||t.countryCode,displayItems:e.orderInfo.displayItems}},initApplePayButton:()=>{const{checkout:t}=awxExpressCheckoutSettings,i=b.getApplePayRequestOptions(w);u=Airwallex.createElement("applePayButton",i),u.mount("awx-ec-apple-pay-btn"),u.on("ready",(t=>{e("#awx-express-checkout-wrapper").show(),e(".awx-apple-pay-btn").show(),e("#awx-express-checkout-button-separator").show()})),u.on("click",(t=>{e(".awx-express-checkout-error").html("").hide()})),u.on("validateMerchant",(async e=>{awxCommonData.getExpressCheckoutData.isProductPage&&await r();const t=await(e=>{const t={security:awxExpressCheckoutSettings.nonce.startPaymentSession,validationURL:e,origin:window.location.host};return a().ajax({type:"POST",data:t,url:n("start_payment_session")}).done((e=>e)).fail((e=>({success:!1,message:e})))})(e?.detail?.validationURL),{paymentSession:s,error:o}=t;s?u.completeValidation(s):u.fail(o)})),u.on("shippingAddressChange",(async e=>{const a=await c();if(a.success)if(a.requiresShipping){const a=await s(e?.detail?.shippingAddress);if(a&&a.success){const{shipping:e,cart:s}=a;_=e.shippingMethods,u.update({amount:{value:s?.orderInfo?.total?.amount||0},lineItems:y(s.orderInfo.displayItems),shippingMethods:(n=e.shippingOptions,n.map((e=>({identifier:e.id,label:e.label,detail:e.description,amount:e.amount})))),totalPriceLabel:t.totalPriceLabel})}else _=[],console.warn(a?.message),u.fail({message:a?.message})}else u.update({amount:{value:a?.orderInfo?.total?.amount||0},lineItems:y(a.orderInfo.displayItems),totalPriceLabel:t.totalPriceLabel});else console.warn(a.message),u.fail({message:a.message});var n})),u.on("shippingMethodChange",(async e=>{const a=await o(e.detail.shippingMethod.identifier,_);if(a&&a.success){const{cart:e}=a;u.update({amount:{value:e?.orderInfo?.total?.amount||0},lineItems:y(e.orderInfo.displayItems),totalPriceLabel:t.totalPriceLabel})}else console.warn(a.message),u.fail({message:a?.message})})),u.on("authorized",(async e=>{let t=e?.detail?.paymentData||{};t.shippingMethods=_;const a=await l(t,"applepay");a.redirect_url?location.href=a.redirect_url:b.processPayment(u,a)})),u.on("error",(e=>{console.error("There was an error",e)}))},getApplePayRequestOptions:e=>{const{button:a,checkout:n}=awxExpressCheckoutSettings,{countryCode:s,currencyCode:o,orderInfo:i,requiresShipping:r}=e;return{mode:t,buttonColor:a.theme,buttonType:a.buttonType,origin:window.location.origin,totalPriceLabel:n.totalPriceLabel,countryCode:s||n.countryCode,requiredBillingContactFields:n.isVirtualPurchase&&n.isSkipBillingForVirtual?h.filter((e=>"postalAddress"!==e)):h,requiredShippingContactFields:m(r),amount:{value:i?i.total.amount:n.subTotal,currency:o||n.currencyCode},lineItems:y(i.displayItems),autoCapture:n.autoCapture}},processPayment:(t,a)=>{if(function(e=5e3){jQuery.blockUI({message:null,overlayCSS:{background:"#fff",opacity:.6}}),setTimeout((function(){jQuery.unblockUI()}),e)}(5e4),"success"===a.result){const{createConsent:n,clientSecret:s,confirmationUrl:o}=a.payload;n?t.createPaymentConsent({client_secret:s}).then((()=>{location.href=o})).catch((t=>{g(),e(".awx-express-checkout-error").html(t.message).show(),console.warn(t.message)})):t.confirmIntent({client_secret:s}).then((()=>{location.href=o})).catch((t=>{g(),e(".awx-express-checkout-error").html(t.message).show(),console.warn(t.message)}))}else g(),e(".awx-express-checkout-error").html(a?.messages).show(),console.warn(a),t.confirmIntent({client_secret:""}).then((()=>{})).catch((e=>{console.warn(e)}))},setButtonHeight:function(){const{button:t}=awxExpressCheckoutSettings,a=t.height;e(".awx-apple-pay-btn apple-pay-button").css("--apple-pay-button-height",a),e(".awx-google-pay-btn button").css("height",a)}};e(document.body).on("updated_checkout",(function(){e(".payment_method_airwallex_express_checkout").hide()})),"awxExpressCheckoutSettings"in window&&"env"in awxExpressCheckoutSettings&&(Airwallex.init({env:awxExpressCheckoutSettings.env,origin:window.location.origin,locale:awxExpressCheckoutSettings.locale}),b.init(),e(document.body).on("updated_cart_totals",(function(){x()})),e(document.body).on("updated_checkout",(function(){x()})),e(document.body).on("change",'[name="quantity"]',(function(){x()})))}))})();